-- =============================================================================
-- SEED DATA FOR RLS / CI TESTING
-- =============================================================================
-- NOTE:
-- - These UUIDs do NOT exist in auth.users
-- - They are used via Supabase User Impersonation
-- - RLS policies rely on auth.uid() matching these values
-- =============================================================================

-- -----------------------------------------------------------------------------
-- TEST USERS (UUID MAP)
-- -----------------------------------------------------------------------------
-- site_admin
--   00000000-0000-0000-0000-000000000001
--
-- admins
--   00000000-0000-0000-0000-000000000010
--   00000000-0000-0000-0000-000000000011
--
-- staff
--   00000000-0000-0000-0000-000000000020
--
-- teachers
--   00000000-0000-0000-0000-000000000030
--   00000000-0000-0000-0000-000000000031
--
-- students
--   00000000-0000-0000-0000-000000000100
--   00000000-0000-0000-0000-000000000101
--   00000000-0000-0000-0000-000000000102
--   00000000-0000-0000-0000-000000000103
-- -----------------------------------------------------------------------------

ALTER TABLE public.profiles
DROP CONSTRAINT IF EXISTS profiles_user_id_fkey;

ALTER TABLE public.user_roles
DROP CONSTRAINT IF EXISTS user_roles_user_id_fkey;

ALTER TABLE public.teacher_students
DROP CONSTRAINT IF EXISTS teacher_students_teacher_id_fkey;

ALTER TABLE public.teacher_students
DROP CONSTRAINT IF EXISTS teacher_students_student_id_fkey;


-- -----------------------------------------------------------------------------
-- PROFILES
-- -----------------------------------------------------------------------------
INSERT INTO public.profiles (user_id, display_name)
VALUES
  -- site_admin
  ('00000000-0000-0000-0000-000000000001', 'Site Admin'),

  -- admins
  ('00000000-0000-0000-0000-000000000010', 'Admin One'),
  ('00000000-0000-0000-0000-000000000011', 'Admin Two'),

  -- staff
  ('00000000-0000-0000-0000-000000000020', 'Staff Member'),

  -- teachers
  ('00000000-0000-0000-0000-000000000030', 'Teacher Alice'),
  ('00000000-0000-0000-0000-000000000031', 'Teacher Bob'),

  -- students
  ('00000000-0000-0000-0000-000000000100', 'Student A'),
  ('00000000-0000-0000-0000-000000000101', 'Student B'),
  ('00000000-0000-0000-0000-000000000102', 'Student C'),
  ('00000000-0000-0000-0000-000000000103', 'Student D')
ON CONFLICT (user_id) DO NOTHING;

-- -----------------------------------------------------------------------------
-- USER ROLES (one role per user)
-- -----------------------------------------------------------------------------
INSERT INTO public.user_roles (user_id, role)
VALUES
  -- site_admin
  ('00000000-0000-0000-0000-000000000001', 'site_admin'),

  -- admins
  ('00000000-0000-0000-0000-000000000010', 'admin'),
  ('00000000-0000-0000-0000-000000000011', 'admin'),

  -- staff
  ('00000000-0000-0000-0000-000000000020', 'staff'),

  -- teachers
  ('00000000-0000-0000-0000-000000000030', 'teacher'),
  ('00000000-0000-0000-0000-000000000031', 'teacher'),

  -- students
  ('00000000-0000-0000-0000-000000000100', 'student'),
  ('00000000-0000-0000-0000-000000000101', 'student'),
  ('00000000-0000-0000-0000-000000000102', 'student'),
  ('00000000-0000-0000-0000-000000000103', 'student')
ON CONFLICT (user_id) DO NOTHING;

-- -----------------------------------------------------------------------------
-- TEACHER â†” STUDENT RELATIONSHIPS
-- -----------------------------------------------------------------------------
-- Teacher Alice teaches Student A & B
INSERT INTO public.teacher_students (teacher_id, student_id)
VALUES
  ('00000000-0000-0000-0000-000000000030', '00000000-0000-0000-0000-000000000100'),
  ('00000000-0000-0000-0000-000000000030', '00000000-0000-0000-0000-000000000101')
ON CONFLICT DO NOTHING;

-- Teacher Bob teaches Student C & D
INSERT INTO public.teacher_students (teacher_id, student_id)
VALUES
  ('00000000-0000-0000-0000-000000000031', '00000000-0000-0000-0000-000000000102'),
  ('00000000-0000-0000-0000-000000000031', '00000000-0000-0000-0000-000000000103')
ON CONFLICT DO NOTHING;

-- =============================================================================
-- END SEED
-- =============================================================================
